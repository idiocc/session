{
"version":3,
"file":"compile/session.js",
"lineCount":513,
"mappings":"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",
"sources":["node_modules/crypto/index.js","node_modules/tty/index.js","node_modules/util/index.js","node_modules/@idio/debug/src/ms.js","node_modules/@idio/debug/src/bytes.js","node_modules/erte/src/index.js","node_modules/@idio/debug/src/modifiers/f.js","node_modules/@idio/debug/src/node.js","node_modules/@idio/debug/src/common.js","node_modules/@idio/debug/src/index.js","node_modules/@goa/uuid/src/rng.js","node_modules/@goa/uuid/src/bytes-to-uuid.js","node_modules/@goa/uuid/src/index.js","node_modules/assert/index.js","src/lib/session.js","src/lib/util.js","src/lib/context.js","src/index.js","src/depack.js"],
"sourcesContent":["export default _crypto\nexport const {\n  Certificate,\n  Cipher,\n  Credentials,\n  DEFAULT_ENCODING,\n  Decipher,\n  DiffieHellman,\n  ECDH,\n  Hash,\n  Hmac,\n  Verify,\n  createCipher,\n  createCipheriv,\n  createCredentials,\n  createDecipher,\n  createDecipheriv,\n  createDiffieHellman,\n  createECDH,\n  createHash,\n  createHmac,\n  createSign,\n  createVerify,\n  getCiphers,\n  getCurves,\n  getDiffieHellman,\n  getHashes,\n  pbkdf2,\n  pbkdf2Sync,\n  privateDecrypt,\n  privateEncrypt,\n  pseudoRandomBytes,\n  publicDecrypt,\n  publicEncrypt,\n  randomBytes,\n  randomFill,\n  randomFillSync,\n  timingSafeEqual,\n} = _crypto","export default tty\nexport const {\n  ReadStream,\n  WriteStream,\n  isatty,\n} = tty","export default util\nexport const {\n  TextDecoder,\n  TextEncoder,\n  callbackify,\n  debug,\n  debuglog,\n  deprecate,\n  error,\n  format,\n  getSystemErrorName,\n  inherits,\n  inspect,\n  isArray,\n  isBoolean,\n  isBuffer,\n  isDate,\n  isError,\n  isFunction,\n  isNull,\n  isNullOrUndefined,\n  isNumber,\n  isObject,\n  isPrimitive,\n  isRegExp,\n  isString,\n  isSymbol,\n  isUndefined,\n  log,\n  print,\n  promisify,\n  puts,\n} = util","/**\n * Helpers.\n */\n\nvar s = 1000\nvar m = s * 60\nvar h = m * 60\nvar d = h * 24\nvar w = d * 7\nvar y = d * 365.25\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {string|number} val\n * @param {Object} [options]\n */\nexport default function(val, options = {}) {\n  var type = typeof val\n  if (type == 'string' && val.length > 0) {\n    const t = /** @type {string} */ (val)\n    return parse(t)\n  } else if (type == 'number' && isFinite(val)) {\n    const n = /** @type {number} */ (val)\n    return options.long ? fmtLong(n) : fmtShort(n)\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  )\n}\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {string} str\n * @api private\n */\nfunction parse(str) {\n  str = String(str)\n  if (str.length > 100) {\n    return\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  )\n  if (!match) {\n    return\n  }\n  var n = parseFloat(match[1])\n  var type = (match[2] || 'ms').toLowerCase()\n  switch (type) {\n  case 'years':\n  case 'year':\n  case 'yrs':\n  case 'yr':\n  case 'y':\n    return n * y\n  case 'weeks':\n  case 'week':\n  case 'w':\n    return n * w\n  case 'days':\n  case 'day':\n  case 'd':\n    return n * d\n  case 'hours':\n  case 'hour':\n  case 'hrs':\n  case 'hr':\n  case 'h':\n    return n * h\n  case 'minutes':\n  case 'minute':\n  case 'mins':\n  case 'min':\n  case 'm':\n    return n * m\n  case 'seconds':\n  case 'second':\n  case 'secs':\n  case 'sec':\n  case 's':\n    return n * s\n  case 'milliseconds':\n  case 'millisecond':\n  case 'msecs':\n  case 'msec':\n  case 'ms':\n    return n\n  default:\n    return undefined\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {number} ms\n * @api private\n */\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms)\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd'\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h'\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm'\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's'\n  }\n  return ms + 'ms'\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {number} ms\n * @api private\n */\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms)\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day')\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour')\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute')\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second')\n  }\n  return ms + ' ms'\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '')\n}\n\n/**\n * @license\n * Copyright (c) 2016 Zeit, Inc.\n * https://npmjs.org/ms\n */","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\nconst formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g\nconst formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/\n\nconst map = {\n  'b':  1,\n  'kb': 1 << 10,\n  'mb': 1 << 20,\n  'gb': 1 << 30,\n  'tb': Math.pow(1024, 4),\n  'pb': Math.pow(1024, 5),\n}\n\nconst parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: (string|undefined),\n *  decimalPlaces: (number|undefined),\n *  fixedDecimals: (boolean|undefined),\n *  thousandsSeparator: (string|undefined),\n *  unitSeparator: (string|undefined),\n *  }} [options] bytes options.\n *\n * @returns {?(string|number)}\n */\n\nexport default function bytes(value, options) {\n  if (typeof value == 'string') {\n    return parse(value)\n  }\n\n  if (typeof value == 'number') {\n    return format(value, options)\n  }\n\n  return null\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {Object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n * @returns {?string}\n */\nexport function format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null\n  }\n\n  const mag = Math.abs(value)\n  const thousandsSeparator = (options && options.thousandsSeparator) || ''\n  const unitSeparator = (options && options.unitSeparator) || ''\n  const decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2\n  const fixedDecimals = Boolean(options && options.fixedDecimals)\n  let unit = (options && options.unit) || ''\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map['pb']) {\n      unit = 'PB'\n    } else if (mag >= map['tb']) {\n      unit = 'TB'\n    } else if (mag >= map['gb']) {\n      unit = 'GB'\n    } else if (mag >= map['mb']) {\n      unit = 'MB'\n    } else if (mag >= map['kb']) {\n      unit = 'KB'\n    } else {\n      unit = 'B'\n    }\n  }\n\n  const val = value / map[unit.toLowerCase()]\n  let str = val.toFixed(decimalPlaces)\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1')\n  }\n\n  if (thousandsSeparator) {\n    str = str.replace(formatThousandsRegExp, thousandsSeparator)\n  }\n\n  return str + unitSeparator + unit\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nexport function parse(val) {\n  if (typeof val == 'number' && !isNaN(val)) {\n    return val\n  }\n\n  if (typeof val != 'string') {\n    return null\n  }\n\n  // Test if the string passed is valid\n  const results = parseRegExp.exec(val)\n  let floatValue, unit = 'b'\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10)\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1])\n    unit = results[4].toLowerCase()\n  }\n\n  return Math.floor(map[unit] * floatValue)\n}","import Diff from './diff'\n\nconst colors = {\n  'black': 30,\n  'red': 31,\n  'green': 32,\n  'yellow': 33,\n  'blue': 34,\n  'magenta': 35,\n  'cyan': 36,\n  'white': 37,\n  'grey': 90,\n}\n\nconst backgroundColors = {\n  'black': 40,\n  'red': 41,\n  'green': 42,\n  'yellow': 43,\n  'blue': 44,\n  'magenta': 45,\n  'cyan': 46,\n  'white': 47,\n}\n\n/**\n * Color the foreground.\n * @param {string} string The string to color.\n * @param {_erte.Color} color The color to apply.\n */\nexport function c(string, color) {\n  const cc = colors[color]\n  if (!cc) return string\n  return `\\x1b[${cc}m${string}\\x1b[0m`\n}\n\n/**\n * Color the background.\n * @param {string} string The string to color.\n * @param {_erte.Color} color The color to apply.\n */\nexport function b(string, color) {\n  const cc = backgroundColors[color]\n  if (!cc) return string\n  return `\\x1b[${cc}m${string}\\x1b[0m`\n}\n\n/**\n * Compares two strings and outputs a coloured version where strings don't match.\n * @param {string} source A string to compare.\n * @param {string} target Target string to compare with.\n * @returns {string} A string which uses shell-codes to highligh differences.\n */\nexport default function erte(source, target) {\n  const diff = new Diff()\n  const d = diff.diff(source, target)\n  const m = d.map(({ added, removed, value }) => {\n    let p\n    const s = value.split(' ')\n    if (added) {\n      p = s.map(t => {\n        return t.replace(/\\n$/mg, '\u23ce\\n')\n      }).map(t => c(t, 'green')).join(b(' ', 'green'))\n    } else if (removed) {\n      p = s.map(t => {\n        return t.replace(/\\n$/mg, '\u23ce\\n')\n      }).map(t => c(t, 'red')).join(b(' ', 'red'))\n    } else {\n      p = c(value, 'grey')\n    }\n    return p\n  })\n  const s = m.join('')\n  return s\n}\n\n/* documentary types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_erte.Color} Color The color to apply.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {('black'|'red'|'green'|'yellow'|'blue'|'magenta'|'cyan'|'white'|'grey')} _erte.Color The color to apply.\n */\n","import { format } from '../bytes'\nimport { c } from 'erte'\n\nexport default {\n  'f': format,\n  'fy'(v) {\n    return c(format(v) || '', 'yellow')\n  },\n  'fr'(v) {\n    return c(format(v) || '', 'red')\n  },\n  'fb'(v) {\n    return c(format(v) || '', 'blue')\n  },\n  'fg'(v) {\n    return c(format(v) || '', 'green')\n  },\n  'fc'(v) { return c(format(v) || '', 'cyan') },\n  'fm'(v) { return c(format(v) || '', 'magenta') },\n}\n","import tty from 'tty'\nimport { inspect, format } from 'util'\nimport ms from './ms'\nimport f from './modifiers/f'\n\nconst colors = [6, 2, 3, 4, 5, 1]\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\nconst inspectOpts = Object.keys(process.env).filter(key => {\n  return /^debug_/i.test(key)\n}).reduce((obj, key) => {\n  // Camel-case\n  const prop = key\n    .substring(6)\n    .toLowerCase()\n    .replace(/_([a-z])/g, (_, k) => {\n      return k.toUpperCase()\n    })\n\n  // Coerce string value into JS value\n  let val = process.env[key]\n  if (/^(yes|on|true|enabled)$/i.test(val)) {\n    val = true\n  } else if (/^(no|off|false|disabled)$/i.test(val)) {\n    val = false\n  } else if (val === 'null') {\n    val = null\n  } else {\n    val = Number(val)\n  }\n\n  obj[prop] = val\n  return obj\n}, {})\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\nfunction useColors() {\n  return 'colors' in inspectOpts ?\n    Boolean(inspectOpts['colors']) :\n    tty.isatty(process.stderr.fd)\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n * @param {!Array} args\n * @this {_debug.DebugFunction}\n */\nfunction formatArgs(args) {\n  const { namespace, useColors: uc, color, diff } = this\n\n  if (uc) {\n    const c = color\n    const colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c)\n    const prefix = `  ${colorCode};1m${namespace} \\u001B[0m`\n\n    args[0] = prefix + args[0].split('\\n').join('\\n' + prefix)\n    args.push(colorCode + 'm+' + ms(diff) + '\\u001B[0m')\n  } else {\n    args[0] = getDate() + namespace + ' ' + args[0]\n  }\n}\n\nfunction getDate() {\n  if (inspectOpts['hideDate']) {\n    return ''\n  }\n  return new Date().toISOString() + ' '\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\nfunction log(...args) {\n  return process.stderr.write(format(...args) + '\\n')\n}\n\n/**\n * Save `namespaces`.\n * @param {string} namespaces\n */\nfunction save(namespaces) {\n  if (namespaces) {\n    process.env['DEBUG'] = namespaces\n  } else {\n    // If you set a process.env field to null or undefined, it gets cast to the\n    // string 'null' or 'undefined'. Just delete instead.\n    delete process.env['DEBUG']\n  }\n}\n\n/**\n * Load `namespaces`.\n * @return {string} returns the previously persisted debug modes\n */\n\nfunction load() {\n  return process.env['DEBUG']\n}\n\n/**\n * Init logic for `debug` instances.\n * @param {_debug.DebugFunction} debug\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n  debug.inspectOpts = { ...inspectOpts }\n}\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n * @param {Object} v\n * @this {_debug.DebugFunction}\n */\nconst o = function(v) {\n  const opts = {\n    ...this.inspectOpts,\n    colors: this.useColors,\n  }\n  return inspect(v, opts)\n    .replace(/\\s*\\n\\s*/g, ' ')\n}\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n * @param {Object} v\n * @this {_debug.DebugFunction}\n */\nconst O = function(v) {\n  const opts = {\n    ...this.inspectOpts,\n    colors: this.useColors,\n  }\n  return inspect(v, opts)\n}\n\nconst formatters = { 'o': o, 'O': O, ...f }\n\n/** @type {_debug.Env} */\nconst NodeEnv = {\n  init,\n  log,\n  formatArgs,\n  save,\n  load,\n  useColors,\n  colors,\n  inspectOpts,\n  formatters,\n}\n\nexport default NodeEnv\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').DebugFunction} _debug.DebugFunction\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../types').Env} _debug.Env\n */","class Debug {\n  /**\n   * Create a debugger with the given `namespace`.\n   * @param {_debug.Env} env\n   */\n  constructor(env) {\n    this.colors = env.colors\n    this.formatArgs = env.formatArgs\n    this.inspectOpts = env.inspectOpts\n    this.log = env.log\n    this.save = env.save\n    this.init = env.init\n\n    this.formatters = env.formatters || {}\n\n    /**\n     * Active `debug` instances.\n     * @type {Array<_debug.DebugFunction>}\n     */\n    this.instances = []\n    /**\n\t   * The currently active debug mode names.\n     * @type {Array<!RegExp>}\n\t   */\n    this.names = []\n    /**\n\t   * The currently active names to skip.\n     * @type {Array<!RegExp>}\n\t   */\n    this.skips = []\n  }\n  createDebug() {\n    const debug = this.getDebug()\n\n    // env-specific initialization logic for debug instances\n    if (typeof this.init == 'function') {\n      this.init(debug)\n    }\n\n    this.instances.push(debug)\n    return debug\n  }\n\n  /**\n   * @returns {_debug.DebugFunction}\n   */\n  getDebug() {\n    const formatters = this.formatters\n    const formatArgs = this.formatArgs\n    const log = this.log // comes from the env\n\n    /** @type {number} */\n    let prevTime\n    /** @type {_debug.DebugFunction} */\n    function debug(...args) {\n      if (!debug.enabled) return\n\n      // Set `diff` timestamp\n      const curr = Number(new Date())\n      const time = curr - (prevTime || curr)\n      debug.diff = time\n      debug.prev = prevTime\n      debug.curr = curr\n      prevTime = curr\n\n      args[0] = coerce(args[0])\n\n      if (typeof args[0] != 'string') {\n        // Anything else let's inspect with %O\n        args.unshift('%O')\n      }\n\n      // Apply any `formatters` transformations\n      let index = 0\n      args[0] = args[0].replace(/%([a-zA-Z%]+)/g, (match, format) => {\n        // If we encounter an escaped % then don't increase the array index\n        if (match == '%%') {\n          return match\n        }\n        index++\n        const formatter = formatters[format]\n        if (formatter) {\n          const val = args[index]\n          match = formatter.call(debug, val)\n\n          // Now we need to remove `args[index]` since it's inlined in the `format`\n          args.splice(index, 1)\n          index--\n        }\n        return match\n      })\n\n      // Apply env-specific formatting (colors, etc.)\n      formatArgs.call(debug, args)\n\n      const logFn = debug.log || log\n      logFn.apply(debug, args)\n    }\n    return debug\n  }\n  /**\n\t * Selects a color for a debug namespace\n\t * @param {string} namespace The namespace string for the for the debug instance to be colored\n\t * @return {number|string} An ANSI color code for the given namespace\n\t */\n  selectColor(namespace) {\n    let hash = 0\n\n    for (let i = 0; i < namespace.length; i++) {\n      hash = ((hash << 5) - hash) + namespace.charCodeAt(i)\n      hash |= 0 // Convert to 32bit integer\n    }\n\n    return this.colors[Math.abs(hash) % this.colors.length]\n  }\n  /**\n\t * Enables a debug mode by namespaces. This can include modes\n\t * separated by a colon and wildcards.\n\t *\n\t * @param {string} namespaces\n\t * @api public\n\t */\n  enable(namespaces) {\n    this.save(namespaces)\n\n    this.names = []\n    this.skips = []\n\n    let i\n    const split = (typeof namespaces == 'string' ? namespaces : '').split(/[\\s,]+/)\n    const len = split.length\n\n    for (i = 0; i < len; i++) {\n      if (!split[i]) {\n        // ignore empty strings\n        continue\n      }\n\n      namespaces = split[i].replace(/\\*/g, '.*?')\n\n      if (namespaces[0] == '-') {\n        this.skips.push(new RegExp('^' + namespaces.substr(1) + '$'))\n      } else {\n        this.names.push(new RegExp('^' + namespaces + '$'))\n      }\n    }\n\n    for (i = 0; i < this.instances.length; i++) {\n      const instance = this.instances[i]\n      instance.enabled = this.enabled(instance.namespace)\n    }\n  }\n  destroy(debug) {\n    const index = this.instances.indexOf(debug)\n    if (index !== -1) {\n      this.instances.splice(index, 1)\n      return true\n    }\n    return false\n  }\n  /**\n\t * Disable debug output.\n\t * @return {string} namespaces\n\t */\n  disable() {\n    const namespaces = [\n      ...this.names.map(toNamespace),\n      ...this.skips.map(toNamespace).map(namespace => '-' + namespace),\n    ].join(',')\n    this.enable('')\n    return namespaces\n  }\n  /**\n\t * Returns true if the given mode name is enabled, false otherwise.\n\t * @param {string} name\n\t * @return {boolean}\n\t */\n  enabled(name) {\n    if (name[name.length - 1] == '*') {\n      return true\n    }\n\n    let i\n    let len\n\n    for (i = 0, len = this.skips.length; i < len; i++) {\n      if (this.skips[i].test(name)) {\n        return false\n      }\n    }\n\n    for (i = 0, len = this.names.length; i < len; i++) {\n      if (this.names[i].test(name)) {\n        return true\n      }\n    }\n\n    return false\n  }\n}\n\n/**\n * @param {string} namespace\n * @this {_debug.DebugContext}\n */\nfunction extend(namespace, delimiter) {\n\n}\n\n/**\n * This is the common logic for both the Node.js and web browser implementations of `debug()`.\n * @param {_debug.Env} env\n */\nexport default function setup(env) {\n  const instance = new Debug(env)\n\n  /**\n   * Creates a function to log messages.\n   * @param {string} namespace\n   */\n  function createDebug(namespace) {\n    const debug = instance.createDebug()\n\n    debug.namespace = namespace\n    debug.useColors = env.useColors()\n    debug.enabled = instance.enabled(namespace)\n    debug.color = instance.selectColor(namespace)\n    /** @this {_debug.DebugContext} */\n    debug.destroy = function() {\n      instance.destroy(this)\n    }\n    /** @this {_debug.DebugContext} */\n    debug.extend = function(ns, delimiter) {\n      const newDebug = (this.namespace + (delimiter === undefined ? ':' : delimiter) + ns)\n      newDebug.log = this.log // don't know why this is here\n      return newDebug\n    }\n\n    instance.enable(env.load())\n\n    return debug\n  }\n  return createDebug\n}\n\n/**\n * Convert regexp to namespace.\n *\n * @param {!RegExp} regexp\n * @return {string} namespace\n * @private\n */\nfunction toNamespace(regexp) {\n  return regexp.toString()\n    .substring(2, regexp.toString().length - 2)\n    .replace(/\\.\\*\\?$/, '*')\n}\n\n/**\n * Coerce `val`.\n * @param {!Error|*} val\n * @return {*}\n * @private\n */\nfunction coerce(val) {\n  if (val instanceof Error) {\n    return val.stack || val.message\n  }\n  return val\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').Env} _debug.Env\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').DebugFunction} _debug.DebugFunction\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').DebugContext} _debug.DebugContext\n */","import NodeEnv from './node'\nimport setup from './common'\n\n/**\n * Creates a function to log messages.\n * @param {string} namespace\n */\nexport default function(namespace) {\n  if (!namespace) throw new Error('To use debug, pass the namespace.')\n  const node = setup(NodeEnv)\n  const debug = node(namespace)\n  return debug\n}","import { randomBytes } from 'crypto'\n\nexport default function nodeRNG() {\n  return randomBytes(16)\n}","\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = []\nfor (var j = 0; j < 256; ++j) {\n  byteToHex[j] = (j + 0x100).toString(16).substr(1)\n}\n\nexport default function bytesToUuid(buf, offset = 0) {\n  var i = offset\n  var bth = byteToHex\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]]).join('')\n}","import rng from './rng'\nimport bytesToUuid from './bytes-to-uuid'\n\n/**\n * Generate and return a RFC4122 v4 UUID.\n * @param {_goa.UuidConfig|string} options Options, or \"binary\" string.\n * @param {Array|Buffer} [buffer] Array or buffer where UUID bytes are to be written.\n\n * @param {number} [offset] Starting index in `buffer` at which to begin writing.\n */\nexport default function v4(options = {}, buffer = null, offset = 0) {\n  var i = buffer && offset\n\n  if (typeof options == 'string') {\n    buffer = options == 'binary' ? new Array(16) : null\n    options = null\n  }\n  const { random, rng: rngFn = rng } = /** @type {_goa.UuidConfig} */ (options)\n\n  const rnds = random || rngFn()\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40\n  rnds[8] = (rnds[8] & 0x3f) | 0x80\n\n  // Copy bytes to buffer, if provided\n  if (buffer) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buffer[i + ii] = rnds[ii]\n    }\n  }\n\n  return buffer || bytesToUuid(rnds)\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('./types').UuidConfig} _goa.UuidConfig\n */","export default assert\nexport const {\n  AssertionError,\n  deepEqual,\n  deepStrictEqual,\n  doesNotThrow,\n  equal,\n  fail,\n  ifError,\n  notDeepEqual,\n  notDeepStrictEqual,\n  notEqual,\n  notStrictEqual,\n  ok,\n  strictEqual,\n  throws,\n} = assert","/**\n * Session model.\n * @implements {_idio.KoaSession}\n */\nexport default class Session {\n  /**\n   * Session constructor.\n   * @param {_idio.KoaContextSession} sessionContext\n   * @param {?{ _maxAge: (number|undefined), _session: (boolean|undefined) }} [obj]\n   */\n  constructor(sessionContext, obj) {\n    /**\n     * @type {number}\n     */\n    this._expire = 0\n    /**\n     * Does the session need saving.\n     * @type {boolean}\n     */\n    this._requireSave = false\n    this._sessCtx = sessionContext\n    this._ctx = sessionContext.ctx\n    if (!obj) {\n      this.isNew = true\n    } else {\n      for (const k in obj) {\n        // restore maxAge from store\n        if (k == '_maxAge') this._ctx.sessionOptions.maxAge = obj._maxAge\n        else if (k == '_session') this._ctx.sessionOptions.maxAge = 'session'\n        else {\n          /** @suppress {checkTypes} */\n          this[k] = obj[k]\n        }\n      }\n    }\n  }\n\n  /**\n   * JSON representation of the session.\n   * @return {!Object}\n   */\n  toJSON() {\n    const obj = {}\n\n    Object.keys(this).forEach(key => {\n      if (key == 'isNew') return\n      if (key[0] == '_') return\n      /**\n       * @suppress {checkTypes}\n       */\n      obj[key] = this[key]\n    })\n\n    return obj\n  }\n\n  /**\n   * Alias to `toJSON`.\n   */\n  inspect() {\n    return this.toJSON()\n  }\n\n  /**\n   * Return how many values there are in the session object.\n   * Used to see if it's \"populated\".\n   */\n  get length() {\n    return Object.keys(this.toJSON()).length\n  }\n\n  /**\n   * Populated flag, which is just a boolean alias of .length.\n   */\n  get populated() {\n    return !!this.length\n  }\n\n  /**\n   * Get session maxAge.\n   */\n  get maxAge() {\n    return /** @type {string|number} */ (this._ctx.sessionOptions.maxAge)\n  }\n\n  /**\n   * Set session maxAge.\n   * @param {number|string} val\n   */\n  set maxAge(val) {\n    this._ctx.sessionOptions.maxAge = val\n    // maxAge changed, must save to cookie and store\n    this._requireSave = true\n  }\n\n  /**\n   * Save this session no matter whether it is populated.\n   */\n  save() {\n    this._requireSave = true\n  }\n\n  /**\n   * Commit this session's headers if autoCommit is set to false.\n   */\n  async manuallyCommit() {\n    await this._sessCtx.commit()\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../..').KoaContextSession} _idio.KoaContextSession\n */","// import crc32 from './crc'\n\n/**\n * Decode the base64 cookie value to an object.\n * @param {string} string\n */\nexport function decode(string) {\n  const body = Buffer.from(string, 'base64').toString('utf8')\n  const json = JSON.parse(body)\n  return json\n}\n\n/**\n * Encode an object into a base64-encoded JSON string.\n * @param {*} body\n */\nexport function encode(body) {\n  body = JSON.stringify(body)\n  return Buffer.from(body).toString('base64')\n}\n\nexport function hash(sess) {\n  return JSON.stringify(sess)\n}","import Debug from '@idio/debug'\nimport Session from './session'\nimport { hash } from './util'\n\nconst debug = Debug('koa-session:context')\n\nexport const ONE_DAY = 24 * 60 * 60 * 1000\n\n/**\n * @implements {_idio.KoaContextSession}\n */\nexport default class ContextSession {\n  /**\n   * context session constructor\n   * @param {!_idio.Context} ctx\n   * @param {!_idio.SessionConfig} [opts] Configuration passed to `koa-session`.\n   */\n  constructor(ctx, opts = {}) {\n    this.ctx = ctx\n    this.app = ctx.app\n    this.opts = opts\n    this.store = opts.ContextStore ? new opts.ContextStore(ctx) : opts.store\n    /** @type {Session|undefined} */\n    this.session = undefined\n    /** @type {string|undefined} */\n    this.externalKey = undefined\n    /** @type {number|undefined} */\n    this.prevHash = undefined\n  }\n\n  /**\n   * Internal logic of `ctx.session`\n   */\n  get() {\n    const { session, store } = this\n    // already retrieved\n    if (session) return session\n    // unset\n    if (session === null) return null\n\n    // cookie session store\n    if (!store) this.initFromCookie()\n    return this.session\n  }\n\n  /**\n   * internal logic of `ctx.session=`\n   * @param {Object} val session object\n   */\n  set(val) {\n    if (val === null) {\n      this.session = null\n      return\n    }\n    if (typeof val == 'object') {\n      // use the original `externalKey` if exists to avoid waste storage\n      this.create(val, this.externalKey)\n      return\n    }\n    throw new Error('this.session can only be set as null or an object.')\n  }\n\n  /**\n   * Init session from external store. Will be called in the front of session middleware.\n   */\n  async initFromExternal() {\n    debug('init from external')\n    const { ctx, opts } = this\n\n    let externalKey\n    if (opts.externalKey) {\n      externalKey = opts.externalKey.get(ctx)\n      debug('get external key from custom %s', externalKey)\n    } else {\n      externalKey = ctx.cookies.get(/** @type {string} */ (opts.key), /** @type {{signed:boolean}} */(opts))\n      debug('get external key from cookie %s', externalKey)\n    }\n\n\n    if (!externalKey) {\n      // create a new `externalKey`\n      this.create()\n      return\n    }\n\n    const json = await this.store.get(externalKey, /** @type {string|number} */ (opts.maxAge), { rolling: opts.rolling || false })\n    if (!this.valid(json, externalKey)) {\n      // create a new `externalKey`\n      this.create()\n      return\n    }\n\n    // create with original `externalKey`\n    this.create(json, externalKey)\n    this.prevHash = hash(this.session.toJSON())\n  }\n\n  /**\n   * Init session from cookie.\n   * @api private\n   */\n  initFromCookie() {\n    debug('init from cookie')\n    const { ctx, opts } = this\n\n    const cookie = ctx.cookies.get(/** @type {string} */ (opts.key), /** @type {{signed:boolean}} */ (opts))\n    if (!cookie) {\n      this.create()\n      return\n    }\n\n    let json\n    debug('parse %s', cookie)\n    try {\n      json = opts.decode(cookie)\n    } catch (err) {\n      // backwards compatibility:\n      // create a new session if parsing fails.\n      // new Buffer(string, 'base64') does not seem to crash\n      // when `string` is not base64-encoded.\n      // but `JSON.parse(string)` will crash.\n      debug('decode %j error: %s', cookie, err)\n      if (!(err instanceof SyntaxError)) {\n        // clean this cookie to ensure next request won't throw again\n        ctx.cookies.set(/** @type {string} */ (opts.key), '', /** @type {!_goa.CookieSetOptions} */ (opts))\n        // ctx.onerror will unset all headers, and set those specified in err\n        err.headers = {\n          'set-cookie': ctx.response.get('set-cookie'),\n        }\n        throw err\n      }\n      this.create()\n      return\n    }\n\n    debug('parsed %j', json)\n\n    if (!this.valid(json)) {\n      this.create()\n      return\n    }\n\n    // support access `ctx.session` before session middleware\n    this.create(json)\n    this.prevHash = hash(this.session.toJSON())\n  }\n\n  /**\n   * Verify session(expired or )\n   * @param {Object} value session object\n   * @param {*} [key] session externalKey(optional)\n   */\n  valid(value, key) {\n    const { ctx } = this\n    if (!value) {\n      this.emit('missed', { key, value, ctx })\n      return false\n    }\n\n    if (value._expire && value._expire < Date.now()) {\n      debug('expired session')\n      this.emit('expired', { key, value, ctx })\n      return false\n    }\n\n    const valid = this.opts.valid\n    if (typeof valid == 'function' && !valid(ctx, value)) {\n      // valid session value fail, ignore this session\n      debug('invalid session')\n      this.emit('invalid', { key, value, ctx })\n      return false\n    }\n    return true\n  }\n\n  /**\n   * @param {string} event event name\n   * @param {*} data event data\n   * @api private\n   */\n  emit(event, data) {\n    setImmediate(() => {\n      this.app.emit(`session:${event}`, data)\n    })\n  }\n\n  /**\n   * Create a new session and attach to ctx.sess\n   * @param {Object} [val] session data\n   * @param {string} [externalKey] session external key\n   */\n  create(val, externalKey) {\n    debug('create session with val: %j externalKey: %s', val, externalKey)\n    if (this.store) this.externalKey = externalKey || this.opts.genid && this.opts.genid(this.ctx)\n    this.session = new Session(this, val)\n  }\n\n  /**\n   * Commit the session changes or removal.\n   *\n   * @api public\n   */\n  async commit() {\n    const { session, opts: { beforeSave }, ctx } = this\n\n    // not accessed\n    if (undefined === session) return\n\n    // removed\n    if (session === null) {\n      await this.remove()\n      return\n    }\n\n    const reason = this._shouldSaveSession()\n    debug('should save session: %s', reason)\n    if (!reason) return\n\n    if (typeof beforeSave == 'function') {\n      debug('before save')\n      beforeSave(ctx, session)\n    }\n    const changed = reason == 'changed'\n    await this.save(changed)\n  }\n\n  _shouldSaveSession() {\n    const { prevHash, session } = this\n\n    // force save session when `session._requireSave` set\n    if (session._requireSave) return 'force'\n\n    // do nothing if new and not populated\n    const json = session.toJSON()\n    if (!prevHash && !Object.keys(json).length) return ''\n\n    // save if session changed\n    const changed = prevHash !== hash(json)\n    if (changed) return 'changed'\n\n    // save if opts.rolling set\n    if (this.opts.rolling) return 'rolling'\n\n    // save if opts.renew and session will expired\n    if (this.opts.renew) {\n      const expire = session._expire\n      const maxAge = session.maxAge\n      // renew when session will expired in maxAge / 2\n      if (expire && maxAge && expire - Date.now() < maxAge / 2) return 'renew'\n    }\n\n    return ''\n  }\n\n  /**\n   * Remove session by calling `.set` on the cookies.\n   * @api private\n   */\n  async remove() {\n    const { opts: { key }, ctx, externalKey, store } = this\n\n    if (externalKey) await store.destroy(externalKey)\n    ctx.cookies.set(/** @type {string} */ (key), '', /** @type {!_goa.CookieSetOptions} */ (this.opts))\n  }\n\n  /**\n   * Save session. Called by the `commit` method.\n   * @param {boolean} changed\n   * @api private\n   */\n  async save(changed) {\n    const { opts: { key, rolling = false, encode, externalKey: optsExternalKey }, externalKey } = this\n    let { opts: { maxAge = ONE_DAY } } = this\n    let json = this.session.toJSON()\n    // set expire for check\n    if (maxAge == 'session') {\n      // do not set _expire in json if maxAge is set to 'session'\n      // also delete maxAge from options\n      this.opts.maxAge = undefined\n      json['_session'] = true\n    } else {\n      // set expire for check\n      json._expire = maxAge + Date.now()\n      json['_maxAge'] = maxAge\n    }\n\n    // save to external store\n    if (externalKey) {\n      debug('save %j to external key %s', json, externalKey)\n      if (typeof maxAge == 'number') {\n        // ensure store expired after cookie\n        maxAge += 10000\n      }\n      await this.store.set(externalKey, json, maxAge, {\n        changed,\n        rolling,\n      })\n      if (optsExternalKey) {\n        optsExternalKey.set(this.ctx, externalKey)\n      } else {\n        this.ctx.cookies.set(/** @type {string} */ (key), externalKey, /** @type {!_goa.CookieSetOptions} */ (this.opts))\n      }\n      return\n    }\n\n    // save to cookie\n    debug('save %j to cookie', json)\n    json = encode(json)\n    debug('save %s', json)\n\n    this.ctx.cookies.set(/** @type {string} */ (key), json, /** @type {!_goa.CookieSetOptions} */ (this.opts))\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('../..').SessionConfig} _idio.SessionConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@goa/cookies').CookieSetOptions} _goa.CookieSetOptions\n */","import Debug from '@idio/debug'\nimport v4 from '@goa/uuid'\nimport assert from 'assert'\nimport ContextSession, { ONE_DAY } from './lib/context'\nimport { encode, decode } from './lib/util'\n\nconst debug = Debug('koa-session')\n\nconst CONTEXT_SESSION = Symbol('context#contextSession')\nconst _CONTEXT_SESSION = Symbol('context#_contextSession')\n\n/**\n * @license\n * MIT https://github.com/miguelmota/is-class\n */\nfunction isClass(fn) {\n  return (typeof fn == 'function' &&\n    (/^class[\\s{]/.test(fn.toString()) ||\n      (/classCallCheck\\(/.test(fnBody(fn)))) // babel.js\n  )\n}\nfunction fnBody(fn) {\n  return fn.toString().replace(/^[^{]*{\\s*/,'').replace(/\\s*}[^}]*$/,'')\n}\n\nconst isFunction = fn => typeof fn == 'function'\n\n/**\n * @type {_idio.session}\n */\nfunction Session(opts = {}) {\n  formatOpts(opts)\n\n  /**\n   * @type {!_idio.Middleware}\n   */\n  async function session(ctx, next) {\n    extendContext(ctx, /** @type {!_idio.SessionConfig} */ (opts))\n\n    /**\n     * @suppress {checkTypes}\n     * @type {ContextSession}\n     */\n    const sess = ctx[CONTEXT_SESSION]\n    if (sess.store) await sess.initFromExternal()\n    try {\n      await next()\n    } finally {\n      if (opts.autoCommit) {\n        await sess.commit()\n      }\n    }\n  }\n  return /** @type {!_goa.Middleware} */ (session)\n}\n\nexport default Session\n\n/**\n * format and check session options\n * @param {!_idio.SessionConfig} [opts] Configuration passed to `koa-session`.\n * @private\n */\nfunction formatOpts(opts = {}) {\n  opts.key = opts.key || 'koa:sess'\n  opts.maxAge = opts.maxAge || ONE_DAY\n\n  // defaults\n  if (opts.overwrite == null) opts.overwrite = true\n  if (opts.httpOnly == null) opts.httpOnly = true\n  if (opts.signed == null) opts.signed = true\n  if (opts.autoCommit == null) opts.autoCommit = true\n\n  debug('session options %j', opts)\n\n  // setup encoding/decoding\n  if (typeof opts.encode != 'function') {\n    opts.encode = encode\n  }\n  if (typeof opts.decode != 'function') {\n    opts.decode = decode\n  }\n\n  const store = opts.store\n  if (store) {\n    assert(isFunction(store.get), 'store.get must be function')\n    assert(isFunction(store.set), 'store.set must be function')\n    assert(isFunction(store.destroy), 'store.destroy must be function')\n  }\n\n  const externalKey = opts.externalKey\n  if (externalKey) {\n    assert(isFunction(externalKey.get), 'externalKey.get must be function')\n    assert(isFunction(externalKey.set), 'externalKey.set must be function')\n  }\n\n  const ContextStore = opts.ContextStore\n  if (ContextStore) {\n    assert(isClass(ContextStore), 'ContextStore must be a class')\n    assert(isFunction(ContextStore.prototype.get), 'ContextStore.prototype.get must be function')\n    assert(isFunction(ContextStore.prototype.set), 'ContextStore.prototype.set must be function')\n    assert(isFunction(ContextStore.prototype.destroy), 'ContextStore.prototype.destroy must be function')\n  }\n\n  if (!opts.genid) {\n    if (opts.prefix) opts.genid = () => `${opts.prefix}${v4()}`\n    else opts.genid = v4\n  }\n}\n\n/**\n * Extend context prototype, add session properties\n * @param {!_idio.Context} context Idio's context prototype.\n * @param {!_idio.SessionConfig} opts Configuration passed to `koa-session`.\n */\nfunction extendContext(context, opts) {\n  if (context.hasOwnProperty(CONTEXT_SESSION)) {\n    return\n  }\n  Object.defineProperties(context, {\n    [CONTEXT_SESSION]: {\n      get() {\n        if (this[_CONTEXT_SESSION]) return this[_CONTEXT_SESSION]\n        this[_CONTEXT_SESSION] = new ContextSession(this, opts)\n        return this[_CONTEXT_SESSION]\n      },\n    },\n    session: {\n      get() {\n        return this[CONTEXT_SESSION].get()\n      },\n      set(val) {\n        this[CONTEXT_SESSION].set(val)\n      },\n      configurable: true,\n    },\n    sessionOptions: {\n      /**\n       * @return {_idio.SessionConfig}\n       */\n      get() {\n        return this[CONTEXT_SESSION].opts\n      },\n    },\n  })\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Context} _idio.Context\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('@typedefs/idio').Middleware} _idio.Middleware\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').SessionConfig} _idio.SessionConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').session} _idio.session\n */","import '@externs/goa'\nimport '@externs/idio'\nimport '@goa/cookies'\nimport '../types/externs'\nimport Session from './'\n\nmodule.exports = Session"],
"names":["randomBytes","_crypto","$jscompDefaultExport","tty","format","util","inspect","val","options","type","length","parse","isFinite","long","msAbs","Math","abs","ms","d","plural","h","m","s","round","Error","JSON","stringify","str","String","match","exec","n","parseFloat","toLowerCase","y","w","name","formatThousandsRegExp","formatDecimalsRegExp","map","pow","value","Number","mag","thousandsSeparator","unitSeparator","decimalPlaces","undefined","fixedDecimals","unit","toFixed","replace","colors","c","string","color","cc","v","inspectOpts","Object","keys","process","env","filter","key","test","reduce","obj","prop","substring","_","k","toUpperCase","NodeEnv","init","debug","log","args","stderr","write","formatArgs","namespace","diff","uc","colorCode","prefix","split","join","push","toISOString","Date","save","namespaces","load","useColors","isatty","fd","formatters","o","opts","O","f","getDebug","enabled","curr","prevTime","prev","coerce","unshift","index","formatter","call","splice","apply","createDebug","instances","selectColor","hash","i","charCodeAt","enable","names","skips","len","RegExp","substr","instance","Debug","indexOf","setup","destroy","debug.destroy","extend","debug.extend","ns","delimiter","newDebug","stack","message","node","nodeRNG","byteToHex","j","toString","v4","buffer","offset","Array","random","rngFn","rng","rnds","ii","buf","assert","Session","sessionContext","_expire","_requireSave","_sessCtx","_ctx","ctx","sessionOptions","maxAge","_maxAge","isNew","forEach","toJSON","commit","decode","body","Buffer","from","json","encode","initFromExternal","externalKey","get","cookies","store","rolling","valid","create","prevHash","session","sess","_shouldSaveSession","renew","expire","now","ContextSession","app","ContextStore","initFromCookie","cookie","err","SyntaxError","set","headers","response","emit","event","data","setImmediate","genid","beforeSave","remove","reason","changed","optsExternalKey","ONE_DAY","CONTEXT_SESSION","Symbol","_CONTEXT_SESSION","formatOpts","overwrite","httpOnly","signed","autoCommit","prototype","opts.genid","extendContext","context","hasOwnProperty","defineProperties","configurable","module","exports","next"]
}
